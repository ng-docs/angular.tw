{"id":"guide/service-worker-communications","title":"Service worker communication","contents":"\n\n\n<div class=\"github-links\">\n  <a href=\"https://github.com/ng-docs/angular-cn/edit/cn/aio/content/guide/service-worker-communications.md?message=docs%3A%20請簡述你的修改...\" aria-label=\"提供編輯建議\" title=\"提供編輯建議\"><i class=\"material-icons\" aria-hidden=\"true\" role=\"img\">mode_edit</i></a>\n</div>\n\n\n<div class=\"content\">\n  <h1 id=\"service-worker-communication\" translation-result=\"on\">與 Service Worker 通訊<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#service-worker-communication\"><i class=\"material-icons\">link</i></a></h1><h1 translation-origin=\"off\">Service worker communication<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#service-worker-communication\"><i class=\"material-icons\">link</i></a></h1>\n\n<p translation-result=\"on\">把 <code><a href=\"api/service-worker/ServiceWorkerModule\" class=\"code-anchor\">ServiceWorkerModule</a></code> 匯入到你的 <code>AppModule</code> 中不僅會註冊 Service Worker，還會提供一些服務，讓你能和 Service Worker 通訊，並控制你的應用快取。</p><p translation-origin=\"off\">Importing <code><a href=\"api/service-worker/ServiceWorkerModule\" class=\"code-anchor\">ServiceWorkerModule</a></code> into your <code>AppModule</code> doesn't just register the service worker, it also provides a few services you can use to interact with the service worker and control the caching of your application.</p>\n\n<h2 id=\"prerequisites\" translation-result=\"on\">前提條件<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#prerequisites\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\">Prerequisites<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#prerequisites\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">對下列知識有基本的瞭解：</p><p translation-origin=\"off\">A basic understanding of the following:</p>\n\n<ul>\n<li>\n<p translation-result=\"on\"><a href=\"guide/service-worker-getting-started\">Service Worker 快速上手</a>。</p><p translation-origin=\"off\"><a href=\"guide/service-worker-getting-started\">Getting Started with Service Workers</a></p>\n\n</li>\n</ul>\n<h2 id=\"swupdate-service\" translation-result=\"on\"><code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> 服務<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#swupdate-服務\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\"><code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> service<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#swupdate-service\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\"><code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> 服務讓你能存取一些事件，這些事件會指出 Service Worker 何時發現並安裝了可用的更新</p><p translation-origin=\"off\">The <code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> service gives you access to events that indicate when the service worker discovers and installs an available update for your application.</p>\n\n<p translation-result=\"on\"><code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> 服務支援四個獨立的操作：</p><p translation-origin=\"off\">The <code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> service supports three separate operations:</p>\n\n<ul>\n<li>\n<p translation-result=\"on\">當在伺服器上<em>檢測到</em>新版本、已安裝並可本地使用或安裝失敗時獲得通知</p><p translation-origin=\"off\">Get notified when an updated version is <em>detected</em> on the server, <em>installed and ready</em> to be used locally or when an <em>installation fails</em></p>\n\n</li>\n<li>\n<p translation-result=\"on\">要求 Service Worker 檢查伺服器上是否有更新。</p><p translation-origin=\"off\">Ask the service worker to check the server for new updates</p>\n\n</li>\n<li>\n<p translation-result=\"on\">要求 Service Worker 為當前標籤頁啟用應用的最新版本</p><p translation-origin=\"off\">Ask the service worker to activate the latest version of the application for the current tab</p>\n\n</li>\n</ul>\n<h3 id=\"version-updates\" translation-result=\"on\">版本更新<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#version-updates\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Version updates<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#version-updates\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\"><code>versionUpdates</code> 是 <code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> 的一個 <code>Observable</code> 屬性，並且會發出四種事件型別：</p><p translation-origin=\"off\">The <code>versionUpdates</code> is an <code>Observable</code> property of <code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> and emits four event types:</p>\n\n<table>\n<thead>\n<tr>\n<th align=\"left\"><nt-wrapper translation-result=\"on\">事件型別</nt-wrapper><nt-wrapper translation-origin=\"off\">Event types</nt-wrapper></th>\n<th align=\"left\"><nt-wrapper translation-result=\"on\">詳情</nt-wrapper><nt-wrapper translation-origin=\"off\">Details</nt-wrapper></th>\n</tr>\n</thead>\n<tbody>\n\n<tr>\n<td align=\"left\"><code><a href=\"api/service-worker/VersionDetectedEvent\" class=\"code-anchor\">VersionDetectedEvent</a></code></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">當 Service Worker 在伺服器上檢測到應用程式的新版本並即將開始下載時發出。</nt-wrapper><nt-wrapper translation-origin=\"off\">Emitted when the service worker has detected a new version of the app on the server and is about to start downloading it.</nt-wrapper></td>\n</tr>\n\n<tr>\n<td align=\"left\"><code><a href=\"api/service-worker/NoNewVersionDetectedEvent\" class=\"code-anchor\">NoNewVersionDetectedEvent</a></code></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">當 Service Worker 檢查了伺服器上應用程式的版本並且沒有找到新版本時發出。</nt-wrapper><nt-wrapper translation-origin=\"off\">Emitted when the service worker has checked the version of the app on the server and did not find a new version.</nt-wrapper></td>\n</tr>\n\n<tr>\n<td align=\"left\"><code><a href=\"api/service-worker/VersionReadyEvent\" class=\"code-anchor\">VersionReadyEvent</a></code></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">當有新版本的應用程式可供客戶端啟用時發出。它可用於通知使用者可用的更新或提示他們重新整理頁面。</nt-wrapper><nt-wrapper translation-origin=\"off\">Emitted when a new version of the app is available to be activated by clients. It may be used to notify the user of an available update or prompt them to refresh the page.</nt-wrapper></td>\n</tr>\n\n<tr>\n<td align=\"left\"><code><a href=\"api/service-worker/VersionInstallationFailedEvent\" class=\"code-anchor\">VersionInstallationFailedEvent</a></code></td>\n<td align=\"left\"><nt-wrapper translation-result=\"on\">在新版本安裝失敗時發出。它可用於日誌/監控目的。</nt-wrapper><nt-wrapper translation-origin=\"off\">Emitted when the installation of a new version failed. It may be used for logging/monitoring purposes.</nt-wrapper></td>\n</tr>\n\n</tbody>\n</table>\n<code-example header=\"log-update.service.ts\" path=\"service-worker-getting-started/src/app/log-update.service.ts\" region=\"sw-update\">\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class LogUpdateService {\n\n  constructor(updates: <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>) {\n    updates.versionUpdates.subscribe(evt =&gt; {\n      switch (evt.type) {\n        case 'VERSION_DETECTED':\n          console.log(`Downloading new app version: ${evt.version.hash}`);\n          break;\n        case 'VERSION_READY':\n          console.log(`Current app version: ${evt.currentVersion.hash}`);\n          console.log(`New app version ready for use: ${evt.latestVersion.hash}`);\n          break;\n        case 'VERSION_INSTALLATION_FAILED':\n          console.log(`Failed to install app version '${evt.version.hash}': ${evt.error}`);\n          break;\n      }\n    });\n  }\n}\n\n</code-example>\n<h3 id=\"checking-for-updates\" translation-result=\"on\">檢查更新<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#checking-for-updates\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Checking for updates<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#checking-for-updates\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">可以要求 Service Worker 檢查是否有任何更新已經發布到了伺服器上。Service Worker 會在初始化和每次導航請求（也就是使用者導航到應用中的另一個地址）時檢查更新。不過，如果你的站點更新非常頻繁，或者需要按計劃進行更新，你可能會選擇手動檢查更新。</p><p translation-origin=\"off\">It's possible to ask the service worker to check if any updates have been deployed to the server.\nThe service worker checks for updates during initialization and on each navigation request —that is, when the user navigates from a different address to your application.\nHowever, you might choose to manually check for updates if you have a site that changes frequently or want updates to happen on a schedule.</p>\n\n<p translation-result=\"on\">透過呼叫 <code>checkForUpdate()</code> 方法來實現：</p><p translation-origin=\"off\">Do this with the <code>checkForUpdate()</code> method:</p>\n\n<code-example header=\"check-for-update.service.ts\" path=\"service-worker-getting-started/src/app/check-for-update.service.ts\">\nimport { <a href=\"api/core/ApplicationRef\" class=\"code-anchor\">ApplicationRef</a>, <a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a> } from '@angular/core';\nimport { <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a> } from '@angular/service-worker';\nimport { concat, interval } from 'rxjs';\nimport { first } from 'rxjs/operators';\n\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class CheckForUpdateService {\n\n  constructor(appRef: <a href=\"api/core/ApplicationRef\" class=\"code-anchor\">ApplicationRef</a>, updates: <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>) {\n    // Allow the app to stabilize first, before starting\n    // polling for updates with `interval()`.\n    const appIsStable$ = appRef.isStable.pipe(first(isStable =&gt; isStable === true));\n    const everySixHours$ = interval(6 * 60 * 60 * 1000);\n    const everySixHoursOnceAppIsStable$ = concat(appIsStable$, everySixHours$);\n\n    everySixHoursOnceAppIsStable$.subscribe(async () =&gt; {\n      try {\n        const updateFound = await updates.checkForUpdate();\n        console.log(updateFound ? 'A new version is available.' : 'Already on the latest version.');\n      } catch (err) {\n        console.error('Failed to check for updates:', err);\n      }\n    });\n  }\n}\n\n\n</code-example>\n<p translation-result=\"on\">該方法返回一個用來表示檢查更新已經成功完成的 <code>Promise&lt;boolean&gt;</code>。這種檢查可能會失敗，它會導致此 <code>Promise</code> 被拒絕（reject）。</p><p translation-origin=\"off\">This method returns a <code>Promise&lt;boolean&gt;</code> which indicates if an update is available for activation.\nThe check might fail, which will cause a rejection of the <code>Promise</code>.</p>\n\n<div class=\"alert is-important\">\n<p translation-result=\"on\">為了避免影響頁面的首次渲染，在註冊 ServiceWorker 指令碼之前，<code><a href=\"api/service-worker/ServiceWorkerModule\" class=\"code-anchor\">ServiceWorkerModule</a></code> 預設會在應用程式達到穩定態之前等待最多 30 秒。如果不斷輪詢更新（比如呼叫 <a href=\"https://developer.mozilla.org/docs/Web/API/WindowOrWorkerGlobalScope/setInterval\">setInterval()</a> 或 RxJS 的 <a href=\"https://rxjs.dev/api/index/function/interval\">interval()</a>）就會阻止應用程式達到穩定態，則直到 30 秒結束之前都不會往瀏覽器中註冊 ServiceWorker 指令碼。</p><p translation-origin=\"off\">In order to avoid negatively affecting the initial rendering of the page, <code><a href=\"api/service-worker/ServiceWorkerModule\" class=\"code-anchor\">ServiceWorkerModule</a></code> waits for up to 30 seconds by default for the application to stabilize, before registering the ServiceWorker script.\nConstantly polling for updates, for example, with <a href=\"https://developer.mozilla.org/docs/Web/API/WindowOrWorkerGlobalScope/setInterval\">setInterval()</a> or RxJS' <a href=\"https://rxjs.dev/api/index/function/interval\">interval()</a>, prevents the application from stabilizing and the ServiceWorker script is not registered with the browser until the 30 seconds upper limit is reached.</p>\n\n<div class=\"alert is-helpful\">\n<p translation-result=\"on\"><strong>注意</strong>：<br>\n應用中所執行的各種輪詢都會阻止它達到穩定態。欲知詳情，參閱 <a href=\"api/core/ApplicationRef#isStable\">isStable</a> 文件。</p><p translation-origin=\"off\"><strong>NOTE</strong>: <br>\nThis is true for any kind of polling done by your application.\nCheck the <a href=\"api/core/ApplicationRef#isStable\">isStable</a> documentation for more information.</p>\n\n</div>\n<p translation-result=\"on\">可以透過在開始輪詢更新之前先等應用達到穩定態來消除這種延遲，如上述例子所示。另外，你還可以為 ServiceWorker 定義不一樣的 <a href=\"api/service-worker/SwRegistrationOptions#registrationStrategy\">註冊策略</a>。</p><p translation-origin=\"off\">Avoid that delay by waiting for the application to stabilize first, before starting to poll for updates, as shown in the preceding example.\nAlternatively, you might want to define a different <a href=\"api/service-worker/SwRegistrationOptions#registrationStrategy\">registration strategy</a> for the ServiceWorker.</p>\n\n</div>\n<h3 id=\"updating-to-the-latest-version\" translation-result=\"on\">升級到最新版本<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#updating-to-the-latest-version\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Updating to the latest version<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#updating-to-the-latest-version\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">你可以透過在新版本就緒後立即重新載入頁面來將現有選項卡更新到最新版本。為避免中斷使用者的進度，一般來說最好提示使用者並讓他們確認可以重新載入頁面並更新到最新版本：</p><p translation-origin=\"off\">You can update an existing tab to the latest version by reloading the page as soon as a new version is ready.\nTo avoid disrupting the user's progress, it is generally a good idea to prompt the user and let them confirm that it is OK to reload the page and update to the latest version:</p>\n\n<code-example header=\"prompt-update.service.ts\" path=\"service-worker-getting-started/src/app/prompt-update.service.ts\" region=\"sw-version-ready\">\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class PromptUpdateService {\n\n  constructor(swUpdate: <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>) {\n    swUpdate.versionUpdates\n        .pipe(filter((evt): evt is <a href=\"api/service-worker/VersionReadyEvent\" class=\"code-anchor\">VersionReadyEvent</a> =&gt; evt.type === 'VERSION_READY'))\n        .subscribe(evt =&gt; {\n          if (promptUser(evt)) {\n            // Reload the page to update to the latest version.\n            document.location.reload();\n          }\n        });\n  }\n\n}\n\n</code-example>\n<div class=\"alert is-important\">\n<p translation-result=\"on\">呼叫 <a href=\"api/service-worker/SwUpdate#activateUpdate\">SwUpdate#activateUpdate()</a> 會把某個頁標籤更新為最新版，而不必重新載入頁面，但是這可能中斷應用程式。</p><p translation-origin=\"off\">Calling <a href=\"api/service-worker/SwUpdate#activateUpdate\">SwUpdate#activateUpdate()</a> updates a tab to the latest version without reloading the page, but this could break the application.</p>\n\n<p translation-result=\"on\">用不重新載入的方式更新可以建立一個<a href=\"guide/glossary#app-shell\">應用外殼</a>與其它頁面資源（如<a href=\"guide/glossary#lazy-loading\">延遲載入塊</a>）不匹配的版本，因為檔名在不同版本之間可能發生變化。</p><p translation-origin=\"off\">Updating without reloading can create a version mismatch between the <a href=\"guide/glossary#app-shell\">application shell</a> and other page resources, such as <a href=\"guide/glossary#lazy-loading\">lazy-loaded chunks</a>, whose filenames may change between versions.</p>\n\n<p translation-result=\"on\">如果你確信對於你的特定使用案例，這種情況是安全的，你可以只用 <code>activateUpdate()</code>。</p><p translation-origin=\"off\">You should only use <code>activateUpdate()</code>, if you are certain it is safe for your specific use case.</p>\n\n</div>\n<h3 id=\"handling-an-unrecoverable-state\" translation-result=\"on\">處理不可恢復的狀態<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#handling-an-unrecoverable-state\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\">Handling an unrecoverable state<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#handling-an-unrecoverable-state\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">在某些情況下，Service Worker 用來為客戶端提供服務的應用版本可能處於損壞狀態，如果不重新載入整個頁面，則無法恢復該狀態。</p><p translation-origin=\"off\">In some cases, the version of the application used by the service worker to serve a client might be in a broken state that cannot be recovered from without a full page reload.</p>\n\n<p translation-result=\"on\">比如，設想以下情形：</p><p translation-origin=\"off\">For example, imagine the following scenario:</p>\n\n<ul>\n<li>\n<p translation-result=\"on\">使用者首次開啟該應用，Service Worker 會快取該應用的最新版本。假設應用要快取的資源包括 <code>index.html</code>、<code>main.&lt;main-hash-1&gt;.js</code> 和 <code>lazy-chunk.&lt;lazy-hash-1&gt;.js</code>。</p><p translation-origin=\"off\">A user opens the application for the first time and the service worker caches the latest version of the application.\nAssume the application's cached assets include <code>index.html</code>, <code>main.&lt;main-hash-1&gt;.js</code> and <code>lazy-chunk.&lt;lazy-hash-1&gt;.js</code>.</p>\n\n</li>\n<li>\n<p translation-result=\"on\">使用者關閉該應用程式，並且有一段時間沒有開啟它。</p><p translation-origin=\"off\">The user closes the application and does not open it for a while.</p>\n\n</li>\n<li>\n<p translation-result=\"on\">一段時間後，會將新版本的應用程式部署到伺服器。新版本中包含檔案 <code>index.html</code>、<code>main.&lt;main-hash-2&gt;.js</code> 和 <code>lazy-chunk.&lt;lazy-hash-2&gt;.js</code>。</p><p translation-origin=\"off\">After some time, a new version of the application is deployed to the server.\nThis newer version includes the files <code>index.html</code>, <code>main.&lt;main-hash-2&gt;.js</code> and <code>lazy-chunk.&lt;lazy-hash-2&gt;.js</code>.</p>\n\n<div class=\"alert is-helpful\">\n<p translation-result=\"on\"><strong>注意</strong>：<br>\n雜湊值現在已經不同了，因為檔案的內容已經改變）。伺服器上不再提供舊版本。</p><p translation-origin=\"off\"><strong>NOTE</strong>: <br>\nThe hashes are different now, because the content of the files changed.</p>\n\n</div>\n<p translation-result=\"on\">舊版本在伺服器上不再可用。</p><p translation-origin=\"off\">The old version is no longer available on the server.</p>\n\n</li>\n<li>\n<p translation-result=\"on\">同時，使用者的瀏覽器決定從其快取中清退 <code>lazy-chunk.&lt;lazy-hash-1&gt;.js</code> 瀏覽器可能決定從快取中清退特定（或所有）資源，以便回收磁碟空間。</p><p translation-origin=\"off\">In the meantime, the user's browser decides to evict <code>lazy-chunk.&lt;lazy-hash-1&gt;.js</code> from its cache.\nBrowsers might decide to evict specific (or all) resources from a cache in order to reclaim disk space.</p>\n\n</li>\n<li>\n<p translation-result=\"on\">使用者再次開啟本應用。此時，Service Worker 將提供它所知的最新版本，當然，實際上對我們是舊版本（<code>index.html</code> 和 <code>main.&lt;main-hash-1&gt;.js</code>）。</p><p translation-origin=\"off\">The user opens the application again.\nThe service worker serves the latest version known to it at this point, namely the old version (<code>index.html</code> and <code>main.&lt;main-hash-1&gt;.js</code>).</p>\n\n</li>\n<li>\n<p translation-result=\"on\">在稍後的某個時刻，該應用程式請求惰性捆綁套件 <code>lazy-chunk.&lt;lazy-hash-1&gt;.js</code>。</p><p translation-origin=\"off\">At some later point, the application requests the lazy bundle, <code>lazy-chunk.&lt;lazy-hash-1&gt;.js</code>.</p>\n\n</li>\n<li>\n<p translation-result=\"on\">Service Worker 無法在快取中找到該資產（請記住瀏覽器已經將其清退了）。它也無法從伺服器上獲取它（因為伺服器現在只有較新版本的 <code>lazy-chunk.&lt;lazy-hash-2&gt;.js</code>）。</p><p translation-origin=\"off\">The service worker is unable to find the asset in the cache (remember that the browser evicted it).\nNor is it able to retrieve it from the server (because the server now only has <code>lazy-chunk.&lt;lazy-hash-2&gt;.js</code> from the newer version).</p>\n\n</li>\n</ul>\n<p translation-result=\"on\">在上述情況下，Service Worker 將無法提供通常會被快取的資產。該特定的應用程式版本已損壞，並且無法在不重新載入頁面的情況下修復客戶端的狀態。在這種情況下，Service Worker 會透過傳送 <code><a href=\"api/service-worker/UnrecoverableStateEvent\" class=\"code-anchor\">UnrecoverableStateEvent</a></code> 事件來通知客戶端。可以訂閱 <code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>#unrecoverable</code> 以得到通知並處理這些錯誤。</p><p translation-origin=\"off\">In the preceding scenario, the service worker is not able to serve an asset that would normally be cached.\nThat particular application version is broken and there is no way to fix the state of the client without reloading the page.\nIn such cases, the service worker notifies the client by sending an <code><a href=\"api/service-worker/UnrecoverableStateEvent\" class=\"code-anchor\">UnrecoverableStateEvent</a></code> event.\nSubscribe to <code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>#unrecoverable</code> to be notified and handle these errors.</p>\n\n<code-example header=\"handle-unrecoverable-state.service.ts\" path=\"service-worker-getting-started/src/app/handle-unrecoverable-state.service.ts\" region=\"sw-unrecoverable-state\">\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class HandleUnrecoverableStateService {\n  constructor(updates: <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>) {\n    updates.unrecoverable.subscribe(event =&gt; {\n      notifyUser(\n        'An error occurred that we cannot recover from:\\n' +\n        event.reason +\n        '\\n\\nPlease reload the page.'\n      );\n    });\n  }\n}\n\n</code-example>\n<h2 id=\"more-on-angular-service-workers\" translation-result=\"on\">關於 Angular Service Worker 的更多資訊<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#more-on-angular-service-workers\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\">More on Angular service workers<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#more-on-angular-service-workers\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">你可能還對下列內容感興趣：</p><p translation-origin=\"off\">You might also be interested in the following:</p>\n\n<ul>\n<li>\n<p translation-result=\"on\"><a href=\"guide/service-worker-notifications\">Service Worker 通知</a></p><p translation-origin=\"off\"><a href=\"guide/service-worker-notifications\">Service Worker Notifications</a></p>\n\n</li>\n</ul>\n<!-- links -->\n<!-- external links -->\n<!-- end links -->\n\n  <div class=\"reviewed\">最後複查時間：2/28/2022</div>\n</div>\n\n\n<!-- links to this doc:\n - api/service-worker/NoNewVersionDetectedEvent\n - api/service-worker/SwUpdate\n - api/service-worker/UnrecoverableStateEvent\n - api/service-worker/UpdateActivatedEvent\n - api/service-worker/UpdateAvailableEvent\n - api/service-worker/VersionDetectedEvent\n - api/service-worker/VersionInstallationFailedEvent\n - api/service-worker/VersionReadyEvent\n - guide/service-worker-devops\n - guide/service-worker-getting-started\n - guide/service-worker-intro\n-->\n<!-- links from this doc:\n - api/core/ApplicationRef\n - api/core/ApplicationRef#isStable\n - api/core/Injectable\n - api/service-worker/NoNewVersionDetectedEvent\n - api/service-worker/ServiceWorkerModule\n - api/service-worker/SwRegistrationOptions#registrationStrategy\n - api/service-worker/SwUpdate\n - api/service-worker/SwUpdate#activateUpdate\n - api/service-worker/UnrecoverableStateEvent\n - api/service-worker/VersionDetectedEvent\n - api/service-worker/VersionInstallationFailedEvent\n - api/service-worker/VersionReadyEvent\n - guide/glossary#app-shell\n - guide/glossary#lazy-loading\n - guide/service-worker-communications#checking-for-updates\n - guide/service-worker-communications#handling-an-unrecoverable-state\n - guide/service-worker-communications#more-on-angular-service-workers\n - guide/service-worker-communications#prerequisites\n - guide/service-worker-communications#service-worker-communication\n - guide/service-worker-communications#swupdate-service\n - guide/service-worker-communications#swupdate-服務\n - guide/service-worker-communications#updating-to-the-latest-version\n - guide/service-worker-communications#version-updates\n - guide/service-worker-communications#與-service-worker-通訊\n - guide/service-worker-communications#關於-angular-service-worker-的更多資訊\n - guide/service-worker-communications#前提條件\n - guide/service-worker-communications#升級到最新版本\n - guide/service-worker-communications#處理不可恢復的狀態\n - guide/service-worker-communications#檢查更新\n - guide/service-worker-communications#版本更新\n - guide/service-worker-getting-started\n - guide/service-worker-notifications\n - https://developer.mozilla.org/docs/Web/API/WindowOrWorkerGlobalScope/setInterval\n - https://github.com/ng-docs/angular-cn/edit/cn/aio/content/guide/service-worker-communications.md?message=docs%3A%20請簡述你的修改...\n - https://rxjs.dev/api/index/function/interval\n-->"}